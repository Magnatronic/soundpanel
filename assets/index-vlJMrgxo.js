(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();class V{constructor(e){this.config=e,this.audioContext=null,this.analyser=null,this.dataArray=null,this.stream=null,this.fftSize=2048,this.smoothing=e.smoothing||.8}async init(){this.stream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize,this.analyser.smoothingTimeConstant=this.smoothing,this.audioContext.createMediaStreamSource(this.stream).connect(this.analyser),this.dataArray=new Uint8Array(this.analyser.frequencyBinCount)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.dataArray),this.dataArray}getVolume(){this.analyser.getByteTimeDomainData(this.dataArray);let e=0;for(let t=0;t<this.dataArray.length;t++){let s=this.dataArray[t]-128;e+=s*s}return Math.sqrt(e/this.dataArray.length)}}class U{constructor(e){this.analyser=e,this.dataArray=new Uint8Array(e.frequencyBinCount)}getBands(){this.analyser.getByteFrequencyData(this.dataArray);const e=this.average(0,10),t=this.average(10,100),s=this.average(100,200);return{bass:e,mid:t,treble:s}}average(e,t){let s=0;for(let r=e;r<t;r++)s+=this.dataArray[r];return s/(t-e)}}class _{constructor(e=30){this.threshold=e,this.lastVolume=0,this.lastBeat=0,this.cooldown=200}detect(e,t=performance.now()){return e>this.threshold&&t-this.lastBeat>this.cooldown?(this.lastBeat=t,!0):(this.lastVolume=e,!1)}}class W{constructor(e,t,s){this.container=e,this.config=t,this.onChange=s,this.render()}render(){this.container.innerHTML=`
      <label>Visualization Mode
        <select id="mode">
          <option value="frequencyBars">Frequency Bars</option>
          <option value="radialBurst">Radial Burst</option>
          <option value="particleSystem">Particle System</option>
          <option value="waveform">Waveform</option>
          <option value="fluidSimulation">Fluid Simulation</option>
        </select>
      </label>
      <label>Sensitivity
        <input type="range" id="sensitivity" min="0.1" max="2" step="0.01" value="${this.config.sensitivity}" />
      </label>
      <label>Color Theme
        <select id="colorTheme">
          <option value="rainbow">Rainbow</option>
          <option value="neon">Neon</option>
          <option value="pastel">Pastel</option>
          <option value="mono">Monochrome</option>
        </select>
      </label>
      <div style="display:flex;gap:0.5rem;">
        <button id="fullscreen">Full Screen</button>
        <button id="pause">Pause/Play</button>
      </div>
      <div style="margin-top:1rem;display:flex;gap:0.5rem;">
        <input id="presetName" type="text" placeholder="Preset name" style="flex:1;" />
        <button id="savePreset">Save Preset</button>
        <button id="loadPreset">Load Preset</button>
      </div>
      <select id="presetList" style="width:100%;margin-top:0.5rem;"></select>
    `,this.addListeners()}addListeners(){this.container.querySelector("#mode").addEventListener("change",e=>{this.onChange("mode",e.target.value)}),this.container.querySelector("#sensitivity").addEventListener("input",e=>{this.onChange("sensitivity",parseFloat(e.target.value))}),this.container.querySelector("#colorTheme").addEventListener("change",e=>{this.onChange("colorTheme",e.target.value)}),this.container.querySelector("#fullscreen").addEventListener("click",()=>{const e=document.getElementById("visualizer");document.fullscreenElement?document.exitFullscreen():e&&e.requestFullscreen&&e.requestFullscreen()}),this.container.querySelector("#pause").addEventListener("click",()=>{this.onChange("pause")})}}class ${constructor(){this.presets=JSON.parse(localStorage.getItem("soundToLightPresets")||"{}")}savePreset(e,t){this.presets[e]=t,localStorage.setItem("soundToLightPresets",JSON.stringify(this.presets))}loadPreset(e){return this.presets[e]||null}getPresetNames(){return Object.keys(this.presets)}deletePreset(e){delete this.presets[e],localStorage.setItem("soundToLightPresets",JSON.stringify(this.presets))}clearPresets(){this.presets={},localStorage.removeItem("soundToLightPresets")}}class x{constructor(e,t,s){this.canvas=e,this.ctx=e.getContext("2d"),this.audioData=t,this.config=s}render(){}resize(){}}function M(o,e,t){return`hsl(${o}, ${e}%, ${t}%)`}class j extends x{render(e){const{ctx:t,canvas:s,config:r}=this;t.globalAlpha=.18,t.fillStyle="#000",t.fillRect(0,0,s.width,s.height),t.globalAlpha=1;const n=6,i=Math.floor(e.length/n),h=Math.max(8,Math.floor(s.width/i)),a=r.sensitivity||1;for(let d=0;d<i;d++){let c=0;for(let p=0;p<n;p++)c+=e[d*n+p];let m=(c/n-128)*2*a;m=Math.max(0,m);const y=s.height*.04,l=m/255,u=Math.max(l*s.height,y),g=d/i*240;t.save(),t.globalAlpha=.7+.3*Math.sin(performance.now()/400+d),t.fillStyle=M(g,80,50),t.fillRect(d*h,s.height-u,h-2,u),t.restore()}}}class k extends x{render(e){const{ctx:t,canvas:s,config:r}=this;t.globalAlpha=.13,t.fillStyle="#000",t.fillRect(0,0,s.width,s.height),t.globalAlpha=1;const n=s.width/2,i=s.height/2,h=Math.min(n,i)*1.8,a=64,d=Math.floor(e.length/a);this.prevRadii||(this.prevRadii=new Array(a).fill(h*.2));for(let c=0;c<a;c++){const m=(e[c*d]-128)*2*(r.sensitivity||1),y=h*.06;let l=Math.max(m/255*h,y);l=this.prevRadii[c]=this.prevRadii[c]*.7+l*.3;const u=c/a*2*Math.PI,g=c/a*240+l*.2;t.save(),t.translate(n,i),t.rotate(u),t.beginPath(),t.arc(0,0,l,-Math.PI/a,Math.PI/a),t.strokeStyle=M(g%360,80,60),t.lineWidth=6+4*Math.sin(performance.now()/600+c),t.shadowBlur=18,t.shadowColor=t.strokeStyle,t.stroke(),t.restore()}}}class D{constructor(e,t,s,r,n,i){this.x=e,this.y=t,this.vx=s,this.vy=r,this.color=n,this.life=1,this.size=i}update(){this.x+=this.vx,this.y+=this.vy,this.vx*=.99,this.vy*=.99,this.life-=.008}}class H extends x{constructor(e,t,s){super(e,t,s),this.particles=[]}render(e){const{ctx:t,canvas:s,config:r}=this;t.globalAlpha=.2,t.fillStyle="#000",t.fillRect(0,0,s.width,s.height),t.globalAlpha=1;const n=e.reduce((l,u)=>l+Math.abs(u-128),0)/e.length,i=s.width*s.height,a=Math.floor(1200*(i/(1280*720))),d=Math.floor((10+n*(r.sensitivity||1)*.2)*(i/(1280*720))),c=s.width/2,m=s.height/2,y=Math.min(s.width,s.height)*.18;for(let l=0;l<d;l++){const u=Math.random()*2*Math.PI,g=Math.random()*y,p=c+Math.cos(u)*g,I=m+Math.sin(u)*g,q=(1+Math.random()*1.5+n*.02)*(Math.min(s.width,s.height)/720),R=Math.cos(u)*q,E=Math.sin(u)*q,F=Math.floor(Math.random()*e.length),z=e[F],N=M((z*2+n*2)%360,90,60),O=.7+(z-128)*.02*(Math.min(s.width,s.height)/720);this.particles.push(new D(p,I,R,E,N,O))}this.particles=this.particles.filter(l=>l.life>0),this.particles.length>a&&this.particles.splice(0,this.particles.length-a);for(const l of this.particles)l.update(),t.globalAlpha=l.life*.8+.2,t.fillStyle=l.color,t.beginPath(),t.arc(l.x,l.y,Math.max(1,l.size),0,2*Math.PI),t.fill();t.globalAlpha=1}}class J extends x{render(e){const{ctx:t,canvas:s,config:r}=this;t.globalAlpha=.18,t.fillStyle="#000",t.fillRect(0,0,s.width,s.height),t.globalAlpha=1,t.save(),t.translate(0,s.height/2),t.beginPath();for(let n=0;n<e.length;n++){const i=n/e.length*s.width,h=s.height*.03;let a=(e[n]-128)*(s.height/256)*(r.sensitivity||1);Math.abs(a)<h&&(a=a<0?-h:h);const d=n/e.length*360+(e[n]-128)*1.5;t.strokeStyle=M(d%360,80,60),n===0||(t.lineTo(i,a),t.stroke(),t.beginPath()),t.moveTo(i,a)}t.restore()}}class X extends x{constructor(e,t,s){super(e,t,s),this.balls=Array.from({length:8},(r,n)=>({x:Math.random()*e.width,y:Math.random()*e.height,r:40+Math.random()*40,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2}))}render(e){const{ctx:t,canvas:s,config:r}=this;t.globalAlpha=.13,t.fillStyle="#000",t.fillRect(0,0,s.width,s.height),t.globalAlpha=1,(!this.balls||this.balls.length<18)&&(this.balls=Array.from({length:18},(n,i)=>({x:Math.random()*s.width,y:Math.random()*s.height,r:40+Math.random()*40,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2})));for(let n=0;n<this.balls.length;n++){const i=this.balls[n];i.x+=i.vx*1.2,i.y+=i.vy*1.2,i.vx+=(Math.random()-.5)*.1,i.vy+=(Math.random()-.5)*.1,i.vx*=.98,i.vy*=.98,(i.x<i.r||i.x>s.width-i.r)&&(i.vx*=-1),(i.y<i.r||i.y>s.height-i.r)&&(i.vy*=-1);const h=Math.floor(n/this.balls.length*e.length),a=30;i.r=Math.max(a,40+(e[h]-128)*2.5*(r.sensitivity||1))}for(let n=0;n<this.balls.length;n++){const i=this.balls[n];t.save(),t.globalAlpha=.45,t.beginPath(),t.arc(i.x,i.y,Math.abs(i.r),0,2*Math.PI),t.fillStyle=M(200+n*20+i.r*2,80,60),t.shadowBlur=30,t.shadowColor=t.fillStyle,t.fill(),t.restore()}}}function A(o){const{width:e,height:t}=o.getBoundingClientRect();return o.width!==e||o.height!==t?(o.width=e,o.height=t,!0):!1}const f={sensitivity:1,colorTheme:"rainbow",smoothing:.8,particleCount:1e3,fadeSpeed:.05,minThreshold:10,maxThreshold:200},v=document.getElementById("visualizer"),Y=document.getElementById("controlPanel");let w,P,b,S="frequencyBars",B=!1;const T={frequencyBars:j,radialBurst:k,particleSystem:H,waveform:J,fluidSimulation:X};function L(o){T[o]&&(S=o,b=new T[S](v,[],f))}function G(o,e){o==="mode"&&L(e),o==="sensitivity"&&(f.sensitivity=e),o==="colorTheme"&&(f.colorTheme=e),o==="pause"&&(B=!B)}async function K(){w=new V(f),await w.init(),new U(w.analyser),new _(f.minThreshold),P=new $,L(S),new W(Y,f,G),Q();function o(){A(v),b&&typeof b.resize=="function"&&b.resize()}window.addEventListener("resize",o),v.addEventListener("fullscreenchange",o),A(v),C()}function Q(){const o=document.getElementById("presetList"),e=document.getElementById("presetName"),t=document.getElementById("savePreset"),s=document.getElementById("loadPreset");function r(){o.innerHTML="";for(const n of P.getPresetNames()){const i=document.createElement("option");i.value=n,i.textContent=n,o.appendChild(i)}}t.onclick=()=>{e.value&&(P.savePreset(e.value,{...f}),r())},s.onclick=()=>{const n=o.value,i=P.loadPreset(n);i&&(Object.assign(f,i),L(f.mode||S))},r()}function C(){if(B){requestAnimationFrame(C);return}A(v);const o=w.getFrequencyData(),e=w.getVolume();window.DEBUG_AUDIO!==!1&&(!window._lastLog||performance.now()-window._lastLog>500)&&(console.log("Volume:",e,"First 8 freq bins:",Array.from(o).slice(0,8)),window._lastLog=performance.now()),b.render(o),requestAnimationFrame(C)}K();
